<!DOCTYPE html>
<html>
<head>

	<title>Colour analysis</title>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="index.css"/>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://fonts.googleapis.com/css?family=Indie+Flower|Roboto" rel="stylesheet">
	<script src="jscolor.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<noscript><meta http-equiv="refresh" content="0; url=https://www.whatismybrowser.com/guides/how-to-enable-javascript/auto"></noscript>
</head>
<body>
	<!-- Hello, adventurer! -->
	<section id="main">
		<p id="disclaimer">Submissions are ordered chronologically.</p>
	</section>
	<style>
		#disclaimer{
			font-size: 16px;
		}
		body {
			font-family: "Roboto";
			font-size: 50px;
			padding: 0;
			margin: 16px;
		}
		span.digits {
			background-color: white;
			margin: 10px;
			padding: 0 8px;
			border: 1px solid black;
		}
		.submission {
			margin-bottom: 10px;
		}
		summary > .submission {
			display: inline-block;
		}
		details > .submission {
    		padding-left: 1.1em;
		}
		details {
			margin-bottom: 1em;
		}
	</style>
	<script>
		class Colour {
			constructor(hexString) {
				if (!hexString) hexString = "000000"
				if (hexString.substring(0, 1) == "#") hexString = hexString.substring(1);
				if (hexString.length != 6) hexString = "FFFFFF";
				this.r = parseInt(hexString.substring(0, 2), 16);
				this.g = parseInt(hexString.substring(2, 4), 16);
				this.b = parseInt(hexString.substring(4), 16);
			}
			setRGB(r, g, b) {
				this.r = r;
				this.g = g;
				this.b = b;
				return this;
			}
			scale(factor) {
				this.r = Math.round(this.r*factor);
				this.g = Math.round(this.g*factor);
				this.b = Math.round(this.b*factor);
				return this;
			}
			hex() {
				var r = this.r % 256;
				var g = this.g % 256;
				var b = this.b % 256;
				if (rgb_to_hex(r, g, g).length != 6) console.log("Warning! Hex string is of invalid length!");
				return rgb_to_hex(r, g, b);
			}
			getH() { return this.hsl()[0]; }
			getS() { return this.hsl()[1]; }
			getL() { return this.hsl()[2]; }

			hsl() {
				var r = this.r%256;
				var g = this.g%256;
				var b = this.b%256;
				// normalise components to range [0, 1]
				r /= 255;
				g /= 255;
				b /= 255;

				var max = Math.max(r, g, b), min = Math.min(r, g, b);
				var h, s, l = (max + min) / 2;

				if (max == min) {
					h = s = 0; // achromatic
				} else {
					var d = max - min;
					s = l > 0.5 ? d / (2 - max - min) : d / (max + min);

					switch (max) {
						case r: h = (g - b) / d + (g < b ? 6 : 0); break;
						case g: h = (b - r) / d + 2; break;
						case b: h = (r - g) / d + 4; break;
					}

					h /= 6;
				}
				return [ h*360, s, l ];
			}
		}

		function createSet(colours, label) {
			var submission = document.createElement("div");
			submission.classList.add("submission");

			for (var i = 0; i < 10; i++) {
				var e = document.createElement("span");
				e.classList.add("digits");
				e.innerHTML = i;
				e.style.backgroundColor = '#' + colours[i].hex();
				submission.appendChild(e);
			}

			var lbl = document.createElement("span");
			lbl.classList.add("labels");
			lbl.innerHTML = label;
			submission.appendChild(lbl);

			return submission;
		}


		function rgb_to_hex(r, g, b) {
			r = (r%256).toString(16);
			g = (g%256).toString(16);
			b = (b%256).toString(16);
			if (r.length == 1) r = "0"+r;
			if (g.length == 1) g = "0"+g;
			if (b.length == 1) b = "0"+b;
			return (r+g+b).toUpperCase();
		}
		function composeHSL(h, s, l) {
			c = rgb(h, s, l);
			rgb_to_hex(c[0], c[1], c[2]);
		}
		function sumRGB(c1, c2) {
			// sums components of two colours in RGB
			return new Colour().setRGB(c1.r+c2.r, c1.g+c2.g, c1.b+c2.b);
		}

		function rgb(h, s, l) {
			h = h/360;

			var r, g, b;

			if (s == 0) {
				r = g = b = l; // achromatic
			} else {
				function hue2rgb(p, q, t) {
					if (t < 0) t += 1;
					if (t > 1) t -= 1;
					if (t < 1/6) return p + (q - p) * 6 * t;
					if (t < 1/2) return q;
					if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
					return p;
				}

				var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
				var p = 2 * l - q;

				r = hue2rgb(p, q, h + 1/3);
				g = hue2rgb(p, q, h);
				b = hue2rgb(p, q, h - 1/3);
			}

			return [ r * 255, g * 255, b * 255 ];
		}

		function distanceRGB(c1, c2) {
			// calculate distance between two colours in rgb space
			var deltaR = c1.r - c2.r;
			var deltaG = c1.g - c2.g;
			var deltaB = c1.b - c2.b;
			var d = Math.sqrt(Math.pow(deltaR, 2), Math.pow(deltaG, 2), Math.pow(deltaB, 2));

			return d;
		}

		function eng_to_int(str) {
			var arr = {"one": 1, "two": 2, "three": 3, "four": 4, "five": 5, "six": 6, "seven":7, "eight": 8, "nine": 9, "zero": 0};
			return arr[str];
		}
		function int_to_eng(i) {
			var arr = ["zero", "one", "two", "three", "four", "five", "six", "seven", "eight", "nine"];
			return arr[i];
		}

		function getAverageColours(person) {
			person["average"] = [];
			for (var num = 0; num < 10; num++) { // for each number
				person["average"][num] = new Colour();
				for (var submission = 0; submission < person.length; submission++) { // for each submission
					person["average"][num] = // new average should be:
						sumRGB(person["average"][num], // old average
							   person[submission][num]); // + this submission
				}
				person["average"][num].scale(1/person.length); // divide by number of submissions
			}
			return person["average"];
		}

		raw_data = [
			["Jess",
				{"one": "F0C800","two": "94D400","three": "C20061","four": "804726","five": "F70000","six": "00F0C8","seven": "124F00","eight": "0045AD","nine": "8B00A1","zero": "E0E0E0"},
				{"one": "FFE600","two": "12A800","three": "EF00F7","four": "825A00","five": "E30000","six": "008CE6","seven": "C7E600","eight": "0062F0","nine": "8800FF","zero": "B6FAF7"}
			],
			["Masa",
				{"one": "004E8D","two": "7FC900","three": "F6EE00","four": "D91600","five": "BA0097","six": "70009B","seven": "00EEFF","eight": "002BAF","nine": "0098AC","zero": "00F1F1"},
				{"one": "0013AB","two": "5BFF00","three": "FFF900","four": "E03C00","five": "FFB9F3","six": "7C31D5","seven": "76CFDA","eight": "002F9B","nine": "5764EB","zero": "DDFCFA"}
			],
			["Domen",
				{"one": "000000","two": "00095C","three": "4B7000","four": "FA0000","five": "F5ED00","six": "06A600","seven": "E37900","eight": "00591E","nine": "0000D6","zero": "00F0D8"},
				{"one": "000000","two": "0E0073","three": "006E05","four": "E70E00","five": "BF8300","six": "005914","seven": "F0FF00","eight": "6A000B","nine": "001AFF","zero": "FFFFFF"}
			],
			["Teja",
				{"one": "26BD00","two": "D98200","three": "FCEB79","four": "FFE2D6","five": "F74A00","six": "EB3D88","seven": "A2FF00","eight": "0000FF","nine": "6600FF","zero": "FFFFFF"},
				{"one": "2DE000","two": "00D4DB","three": "DE5900","four": "C22700","five": "FF0A0A","six": "FFBDBD","seven": "2CC937","eight": "6000DE","nine": "D65600","zero": "FFFFFF"}
			],
			["Nina",
				{"one": "AFA500","two": "006934","three": "23009E","four": "A30016","five": "008AB2","six": "523F00","seven": "8F007F","eight": "FF2626","nine": "00DACE","zero": "726F00"},
				{"one": "D800C7","two": "514C52","three": "E03E00","four": "51A8AB","five": "7BF5FF","six": "58A85E","seven": "D9F100","eight": "FF6868","nine": "7D7D7D","zero": "000000"}
			],
			["Ita", {"one": "C21300","two": "007F15","three": "020005","four": "9026B1","five": "E7D927","six": "503800","seven": "001E52","eight": "45DCD3","nine": "690000","zero": "EEB957"}],
			["Novoselec", {"one": "000000","two": "D4DB00","three": "004FD9","four": "DE6000","five": "0000D1","six": "7600BA","seven": "D42300","eight": "077000","nine": "C900C3","zero": "FFFFFF"}],
			["Lili", {"one": "EDC700","two": "008425","three": "2C00C9","four": "B20079","five": "00B2CB","six": "AF1700","seven": "E500AF","eight": "493900","nine": "120035","zero": "FFFFFF"}],
			//["Phantom boi (probably nina 3)", {"one": "1FBA00","two": "B10091","three": "826800","four": "1C1407","five": "00B5C0","six": "5D5086","seven": "D86D94","eight": "68001C","nine": "575556","zero": "00028B"}],
			//["Unknown", {"one": "FFFFFF","two": "FCFA00","three": "E600E3","four": "30C600","five": "008AE6","six": "D70043","seven": "48040D","eight": "5F0088","nine": "B48400","zero": "D5D5D5"}],
		];

		/* format raw data */
		var data = [];
		for (var i = 0; i < raw_data.length; i++) {
			var name = raw_data[i][0]
			data[name] = [];
			for (var submission = 0; submission < raw_data[i].length-1; submission++) { // for each submission
				data[name][submission] = [];
				for (var num = 0; num < 10; num++) {
					data[name][submission][num] = new Colour(raw_data[i][submission+1][int_to_eng(num)]);
				}
			}
		}
		console.log("Initialised data: ");
		console.log(data);

		//submission = createSet();
		//$('#main')[0].appendChild(submission);

		// calculate averages
		for (var person in data) {
			data[person]["average"] = getAverageColours(data[person]);
		}

		// add the "global" set
		data["Global"] = []
		var i = 0;
		for (var person in data) {
			if (person == "Global") continue;
			data["Global"][i] = data[person]["average"];
			i++;
		}

		data["Global"]["average"] = getAverageColours(data["Global"]);

		for (person in data) {
			var details = document.createElement("details");
			var summary = document.createElement("summary");
			summary.appendChild(createSet(data[person]["average"], person));
			details.appendChild(summary);
			for (var submission = 0; submission < data[person].length; submission++) {
				details.appendChild(createSet(data[person][submission], "Submission "+submission));
			}
			$("#main")[0].appendChild(details);
		}

		/*
		// calculate global average
		var avg = [];
		for (var num = 0; num < 10; num++) { // for each number
			var sum = new Colour();
			var count = 0;
			for (var person in data) { // for each person
				for (var submission = 0; submission < data[person].length; submission++) { // for each submission
					sum = sumRGB(sum, data[person][submission][num]);
					count++;
				}
			}
			avg[i] = sum.scale(1 / count);
		}
		data["Global"] = avg;
		*/

		$('#main')[0].appendChild(document.createElement("br"));

		/* generate deviations * /
		for (var i = 0; i < data.length; i++) {
			var deviations = {}
			for (var j = 0; j < 10; j++) {

				//deviations[int_to_eng(j)] = average[] - data[i][1]
			}
			addSet(deviations, "Deviation of " + data[i][0]);
		}*/
	</script>
</body>
</html>
